import numpy as np
import my_pycaffe_io as mpio
import street_utils as su

def create_window_file():
	setName = ['test', 'train']
	for i,s in enumerate(setName):
		inName = 'pose-files/annotations_master_%s_pascal3d.txt' % s
		oName  = 'pose_files/euler_%s_pascal3d.txt' % s
		inFid  = mpio.GenericWindowReader(inName)
		imDat, lbls = [], []
		N = inFid.num_
		for i in range(inFid.num_):
			im, lb = inFid.read_next()
			imDat.append(im)
			lbls.append(lb)
		inFid.close()
		randSeed = 3 + (2 * i)
		randState = np.random.RandomState(randSeed)
		perm = randState.permutation(N)

		oFid = mpio.GenericWindowWriter(oName, N, 1, 3)
		for p in perm:
			im, lb = imDat[p], lbls[p]
			rots = []
			for theta in lbs:
				rots.append(su.rot_range(theta)/30.0)
			oFid.write(rots, *im)
		oFid.close()
		
